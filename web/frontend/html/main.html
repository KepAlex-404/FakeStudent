<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Student</title>
    <link href="../frontend/css/styles.css" rel="stylesheet">
</head>

<body>
    <header>
        <div style="text-align: start;">Hello, motherfucker <button id='signout' onclick="signOut()">Sign out</button>
        </div>
    </header>
    <main>
        <div id=tasks>
            <div style="height: 80%; width: 80%; background-color: #043d40; overflow-y: scroll; min-width: 300px;">
                <div id='taskslist'>
                    <div class="tasklist">Task1</div>
                    <div class="tasklist">Task2</div>
                </div>
                <div><button id="addbutton" onclick="
                    document.getElementById('addtask').style.display='grid'">Addtask
                    </button></div>
            </div>

            <div id='addtask'>
                <div> <button id="hide" style="margin: 0; margin: 0; padding: 5px 30px 0 0;"
                        onclick="document.getElementById('addtask').style.display='none'">×</button>
                </div>
                <div>
                    <input id="text" type="text" placeholder="Title" required>
                    <input id="url" type="url" placeholder="URL" required>
                    <label>Datetime</label>
                    <input id="dttm" type="datetime-local" required>
                    <label>How often</label>
                    <select id="howoften" required>
                        <option value='1'>Every day</option>
                        <option value='7'>Every week</option>
                        <option value='14'>Every two weeks</option>
                    </select>
                    <label>Conferencing platform</label>
                    <select id='platform' required>
                        <option value='bbb'>BBB</option>
                    </select>
                    <button type="submit" onclick="createTask()">Create</button>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div>© 2021 Fake Student. All Rights Reserved.</div>
        <div class="athors">Bogdan Chernykh, Vlada Yaremenko, Alexey Gryshyn</div>
    </footer>
    <script>
        (async () => {
            const response = await fetch('http://localhost:8000/tasks', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json;charset=utf-8'
                    },
            })
            const data = await response.json()
            data.forEach(task => {
                divtask = `<div class="tasklist">${task.title}</div>`
                document.getElementById('taskslist').innerHTML += divtask
            })
        })()


        let username = "username"
        // document.getElementsByTagName('header')[0].innerHTML = `Hello, ${username}`;

        let createTask = async () => {
            let newTask = {
                "title": document.getElementById("text").value,
                "url": document.getElementById("url").value,
                "dttm": document.getElementById("dttm").value,
                "delta": document.getElementById("howoften").value,
                "repeatTitle": document.getElementById('howoften').selectedOptions[0].text,
                "platformTitle": document.getElementById("platform").value
            }

            if (newTask.title && newTask.url && newTask.dttm && newTask.delta && newTask.repeatTitle && newTask.platformTitle) {

                const response = await fetch('http://localhost:8000/tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json;charset=utf-8'
                    },
                    body: JSON.stringify(newTask)
                });
                const data = await response.json()
                document.getElementById('addtask').style.display='none'
                let task = document.createElement('div');
                task.className = 'tasklist'
                task.id = data.id
                task.innerHTML = newTask.title;
                let firstTask = document.getElementById('taskslist').firstChild
                document.getElementById('taskslist').insertBefore(task, firstTask)
                console.log('data', data);
                console.log(response)
            }
        }

        let signOut = async () => {
            try {
                const response = await fetch('http://localhost:8000/users/signout', {
                    method: 'DELETE',
                })
                console.log('done')
            } catch (error) {
                console.log(error)
            } finally {
                // Actually must be in try block
                location.reload()
            }
        }

    </script>
</body>

</html>